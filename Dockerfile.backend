FROM node:20-alpine

# Verify npm is installed
RUN npm --version && node --version

WORKDIR /app

COPY backend/package*.json ./backend/

# Install dependencies
RUN cd backend && npm install --verbose --legacy-peer-deps

COPY backend/ ./backend/

WORKDIR /app/backend

ENV NODE_ENV=production
ENV PORT=3000

EXPOSE 3000

CMD ["node", "index.js"]
